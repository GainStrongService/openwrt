/dts-v1/;

#include "mt7628an.dtsi"

#include <dt-bindings/gpio/gpio.h>
#include <dt-bindings/input/input.h>

/ {
        compatible = "gainstrong,minibox-lora", "mediatek,mt7628an-soc";
        model = "MiniBox-LoRa (16M)";

        chosen {
                bootargs = "console=ttyS0,57600";
        };

        memory@0 {
                /* DDR size is 64MB */
                device_type = "memory";
                reg = <0x0 0x4000000>;
        };

        gpio-keys-polled {
                compatible = "gpio-keys-polled";
                #address-cells = <1>;
                #size-cells = <0>;
                poll-interval = <20>;

                reset {
                        /* RESET is GPIO38 */
                        label = "reset";
                        gpios = <&gpio1 6 GPIO_ACTIVE_LOW>;
                        linux,code = <KEY_RESTART>;
                };
        };

        gpio-leds {
                compatible = "gpio-leds";

                wifi {
                        /* WiFi led is GPIO44, defined in wled_an group */
                        label = "wifi";
                        gpios = <&wgpio 0 GPIO_ACTIVE_HIGH>;
                        default-state = "on";
                };
        };

        wgpio: gpio-wifi {
                compatible = "mediatek,gpio-wifi";
                #address-cells = <1>;
                #size-cells = <0>;
                gpio-controller;
                #gpio-cells = <2>;
        };
};

&pinctrl {
        state_default: pinctrl0 {
                gpio {
                        ralink,group = "gpio";      /* GPIO11 */
                        ralink,function = "gpio";
                };

                perst {
                        ralink,group = "perst";     /* GPIO36 */
                        ralink,function = "gpio";
                };

                refclk {
                        ralink,group = "refclk";    /* GPIO37 */
                        ralink,function = "gpio";
                };

                i2s {
                        ralink,group = "i2s";       /* GPIO0 - GPIO3 */
                        ralink,function = "gpio";
                };

                spis {
                        ralink,group = "spis";      /* GPIO14 - GPIO17 */
                        ralink,function = "gpio";
                };

                wled_kn {
                        ralink,group = "wled_kn";   /* GPIO35 */
                        ralink,function = "gpio";
                };

                wled_an {
                        ralink,group = "wled_an";   /* GPIO44 */
                        ralink,function = "wled_an";
                };

                wdt {
                        ralink,group = "wdt";       /* GPIO38 */
                        ralink,function = "gpio";
                };

                pwm0 {
                        ralink,group = "pwm0";      /* GPIO18 */
                        ralink,function = "gpio";
                };

                pwm1 {
                        ralink,group = "pwm1";      /* GPIO19 */
                        ralink,function = "gpio";
                };

                i2c {
                        ralink,group = "i2c";       /* GPIO4 - GPIO5 */
                        ralink,function = "gpio";
                };

                sdxc {
                        ralink,group = "sdmode";    /* GPIO22 - GPIO29 */
                        ralink,function = "gpio";
                };

                p4led_an {
                        ralink,group = "p4led_an";  /* GPIO39 */
                        ralink,function = "gpio";
                };

                p3led_an {
                        ralink,group = "p3led_an";  /* GPIO40 */
                        ralink,function = "gpio";
                };

                p2led_an {
                        ralink,group = "p2led_an";  /* GPIO41 */
                        ralink,function = "gpio";
                };
        };
};

&spi0 {
        compatible = "ralink,mt76x8-spi";

        pinctrl-names = "default";
        pinctrl-0 = <&spi_pins>, <&spi_cs1_pins>;
        status = "okay";

        m25p80@0 {
                /* ROM size is 16MB */
                #address-cells = <1>;
                #size-cells = <1>;
                compatible = "jedec,spi-nor";
                reg = <0>;
                spi-max-frequency = <40000000>;
                m25p,chunked-io = <31>;

                partition@0 {
                        label = "u-boot";
                        reg = <0x0 0x30000>;
                        read-only;
                };

                partition@30000 {
                        label = "u-boot-env";
                        reg = <0x30000 0x10000>;
                };

                factory: partition@40000 {
                        label = "factory";
                        reg = <0x40000 0x10000>;
                        read-only;
                };

                partition@50000 {
                        label = "firmware";
                        reg = <0x50000 0xfb0000>;
                };
        };

        sx1276@1 {
                compatible = "semtech,sx1276";
                reg = <1>;
                spi-max-frequency = <15000000>;

                dio-list = <0 1 2 3 255 255>;   /* DIO pins from DIO0 to DIO5 are GPIO0 to GPIO3, 255 stands for unused */
                reset = <40>;                   /* RESET pins is GPIO40 */
                ant-sw-lf = <41>;               /* 433MHz antenna control is GPIO41 */
                ant-sw-hf = <39>;               /* 868MHz antenna control is GPIO39 */
        };
};

&ethernet {
        mtd-mac-address = <&factory 0x28>;
};

&wmac {
        status = "okay";    /* wirelss dirver from OpenWRT */
};

&ehci {
        status = "okay";
};

&ohci {
        status = "okay";
};
